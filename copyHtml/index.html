<!DOCTYPE html>
<html>
<head>
	<title></title>
	<meta charset="utf-8">
	<link rel="stylesheet" href="css/style.css">
	<script src="js/jquery-1.4.2.min.js"></script>
	<script src="js/json2.js"></script>
</head>
<body>
  <h1>对页面源代码的处理</h1>
  <p>定义了一个全局对象：'htmlHandle'</p>
  <p>方法的调用: 'htmlHandle.outputHtml()'得到一个返回值，其为处理过的源代码</p>
  <p>
  	<input type="text" /><input type="text" />
  </p>
  <p>
  	<input type="text" /><input type="text" />
  </p>
  <p>
  	<label><input type="radio" value="一" name="radio1"/>一</label>
  	<label><input type="radio" value="二" name="radio1"/>二</label>
  </p>
  <p>
  	<label><input type="radio" value="三" name="radio2"/>三</label>
  	<label><input type="radio" value="四" name="radio2"/>四</label>
  </p>
  <p>
  	<label><input type="checkbox" value="一" name="checkbox1"/>一</label>
  	<label><input type="checkbox" value="二" name="checkbox1"/>二</label>
  </p>
  <p>
  	<label><input type="checkbox" value="三" name="checkbox2"/>三</label>
  	<label><input type="checkbox" value="四" name="checkbox2"/>四</label>
  </p>
  
  <select>
  	<option value="0">0</option>
  	<option value="1">1</option>
  	<option value="2">2</option>
  </select>

  <p>
  	<textarea></textarea>
  </p>

  <p>
  	<button type="button" value="测试导出" id="output">测试导出</button>
  </p>

  <script>
  	var htmlHandle = {
  		//input转换成span
  		input2span: function($inputs){
  			if($inputs && $inputs.length){
  				$inputs.each(function(){
  					var $this = $(this),
  					    value = $this.val();   
  					$this.after('<span class="input2span" style="border: 0;border-bottom: 1px solid #999;padding-left: 10px;padding-right: 10px;">' + value + '</span>');   
  					$this.remove(); 
  				});
  			}
  		},
  		//radio转换成span
  		radio2span: function($inputs){
  			if($inputs && $inputs.length){
  				$inputs.each(function(){
  					var $this = $(this),
  					    value = $this.val(),
  					    $p = $this.parent();
  					if($this.attr("checked")){
  						$p.after('<span class="input2span" style="border: 0;border-bottom: 1px solid #999;padding-left: 10px;padding-right: 10px;">' + value + '</span>'); 
  					}
  					$p.remove(); 
  				});
  			}
  		},
  		//select转换成span
  		select2span: function($inputs){
  			if($inputs && $inputs.length){
  				$inputs.each(function(){
  					var $this = $(this),
  					    value = $this.attr('data-value');
  					$this.after('<span class="input2span" style="border: 0;border-bottom: 1px solid #999;padding-left: 10px;padding-right: 10px;">' + value + '</span>');   
  					$this.remove();
  				});
  			}
  		},
  		//对select的选中值做一个处理
  		writeSelectValue: function($inputs){
  			if($inputs && $inputs.length){
  				$inputs.each(function(){
  					var $this = $(this);
  					$this.attr('data-value',$this.val());
  				});
  			}
  		},
  		//textarea转换成div
  		textarea2div: function($inputs){
  			if($inputs && $inputs.length){
  				$inputs.each(function(){
  					var $this = $(this),
  					    value = $this.val();
  					$this.after('<div class="textarea2div" style="white-space: pre-wrap;word-wrap: break-word;border: 0;border-bottom: 1px solid #999;">' + value + '</div>');   
  					$this.remove(); 
  				});
  			}
  		},
  		//隐藏各种组件的操作按钮
  		hidePluginsCtrl: function($html){
  			$html.find('.advance-table-btn').hide();
  			$html.find('.btn-add-img').hide();
  			$html.find('.ctrl').hide();
  		},
  		//输出页面源码
  		outputHtml: function(){
  			var $copyHtml,
  		    $inputs,
  		    $radiosAndCheckboxs,
  		    $selects,
  		    $textarea;

	      htmlHandle.writeSelectValue($('body select'));//为了保证select的值能正确转换，将其值存入data-value属性中

	  		$copyHtml = $('html').clone();//正式使用：复制整个页面
	  		//$copyHtml = $('html');//测试：复制整个页面

		    $inputs = $copyHtml.find('input[type="text"]');//找出克隆后的所有input
		    $radiosAndCheckboxs = $copyHtml.find('input[type="radio"],input[type="checkbox"]');//找出克隆后的所有radio和checkbox
		    $selects = $copyHtml.find('select');//找出克隆后的所有select
		    $textarea = $copyHtml.find('textarea');//找出克隆后的所有textarea
	  		  
	  		htmlHandle.input2span($inputs);//将input替换成span
	  		htmlHandle.radio2span($radiosAndCheckboxs);//将radio和checkbox替换成span
	  		htmlHandle.select2span($selects);//将select替换成span
	  		htmlHandle.textarea2div($textarea);//将textarea替换成div

	  		htmlHandle.hidePluginsCtrl($copyHtml);//隐藏空间的控制按钮

	  		return $copyHtml[0].outerHTML;
  		}
  	};


  	$('#output').click(function(){
  		console.log(htmlHandle.outputHtml());
  	});
  </script>
</body>
</html>